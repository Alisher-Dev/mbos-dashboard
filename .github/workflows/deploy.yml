name: Deploy Backend

on:
  push:
    branches: [master] # Убедитесь, что вы пушите в нужную ветку

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Подключение к VPS и деплой
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USERNAME }}
          password: ${{ secrets.PASSWORD }}
          port: ${{ secrets.PORT }}
          script: |
            cd /home/mbos-dashboard || exit 1  # Перейти в директорию проекта, выходить, если не удалось
            pm2 delete server || true           # Удаляем процесс, если он существует
            git fetch                            # Получаем обновления
            git pull                             # Сливаем обновления
            yarn install                         # Устанавливаем зависимости
            yarn build                           # Строим проект
            pm2 start dist/main.js              # Запускаем приложение
